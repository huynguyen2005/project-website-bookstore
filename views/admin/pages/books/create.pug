extends ../../layouts/default
include ../../mixins/select-tree.pug
include ../../mixins/alert.pug

block main
  if (role.permissions.includes("books_create"))
    +alert-success(5000)
    +alert-error(5000)

    div(class="card")
      div(class="card-header d-flex justify-content-between align-items-center")
        h5(class="mb-0") Thêm sách mới

      div(class="card-body")
        form(
          action=`${prefixAdmin}/books/create`
          method="POST"
          enctype="multipart/form-data"
        )
          // --- Tên sách ---
          div(class="form-group")
            label(for="bookName") Tên sách
            input(
              id="bookName"
              class="form-control"
              type="text"
              name="bookName"
              placeholder="Nhập tên sách"
            )

          // --- Nổi bật ---
          div(class="form-group")
            label(for="featured") Nổi bật
            div(class="d-flex align-items-center gap-4")
              div(class="form-check form-check-inline")
                input(
                  type="radio"
                  class="form-check-input"
                  id="featured1"
                  name="featured"
                  value="1"
                )
                label(for="featured1" class="form-check-label") Nổi bật

              div(class="form-check form-check-inline")
                input(
                  type="radio"
                  class="form-check-input"
                  id="featured0"
                  name="featured"
                  value="0"
                  checked
                )
                label(for="featured0" class="form-check-label") Không

          // --- Mô tả ---
          div(class="form-group")
            label(for="description") Mô tả
            textarea(
              id="description"
              class="form-control"
              name="description"
              rows="3"
              placeholder="Nhập mô tả..."
            )

          // --- Giá (VNĐ) ---
          div(class="form-group")
            label(for="price") Giá (VNĐ)
            input(
              id="price"
              class="form-control"
              type="number"
              name="price"
              min="0"
              placeholder="VD: 170000"
            )

          // --- Giảm giá (%) ---
          div(class="form-group")
            label(for="discountPercent") Giảm giá (%)
            input(
              id="discountPercent"
              class="form-control"
              type="number"
              name="discountPercent"
              min="0"
              max="100"
              placeholder="VD: 10"
            )

          // --- Kích thước ---
          div(class="form-group")
            label(for="size") Kích thước
            input(
              id="size"
              class="form-control"
              type="text"
              name="size"
              placeholder="VD: 14x20cm"
            )

          // --- Ngày xuất bản ---
          div(class="form-group")
            label(for="publishDate") Ngày xuất bản
            input(
              id="publishDate"
              class="form-control"
              type="date"
              name="publishDate"
            )

          // --- Số trang ---
          div(class="form-group")
            label(for="pageCount") Số trang
            input(
              id="pageCount"
              class="form-control"
              type="number"
              name="pageCount"
              min="0"
            )

          // --- Số lượng tồn kho ---
          div(class="form-group")
            label(for="stockQuantity") Số lượng tồn kho
            input(
              id="stockQuantity"
              class="form-control"
              type="number"
              name="stockQuantity"
              min="0"
            )

          // --- Đánh giá trung bình ---
          div(class="form-group")
            label(for="averageRating") Đánh giá
            input(
              id="averageRating"
              class="form-control"
              type="number"
              step="0.1"
              name="averageRating"
              placeholder="VD: 4.0"
            )

          // --- Lượt đánh giá ---
          div(class="form-group")
            label(for="reviewCount") Lượt đánh giá
            input(
              id="reviewCount"
              class="form-control"
              type="number"
              name="reviewCount"
              placeholder="VD: 5000"
            )

          // --- Nhà xuất bản ---
          div(class="form-group")
            label(for="publisher") Nhà xuất bản
            input(
              id="publisher"
              class="form-control"
              type="text"
              name="publisher"
              placeholder="VD: NXB Trẻ"
            )

          // --- Nhà phân phối ---
          div(class="form-group")
            label(for="distributor") Nhà phân phối
            input(
              id="distributor"
              class="form-control"
              type="text"
              name="distributor"
              placeholder="VD: Alpha Books"
            )

          // --- Tác giả ---
          div(class="form-group")
            label(for="author_id") Tác giả
            select(class="form-control" name="author_id" id="author_id")
              option(value="") -- Chọn tác giả --
              each author in authors
                option(value=author.id)= author.fullName

          // --- Loại bìa ---
          div(class="form-group")
            label(for="coverType_id") Loại bìa
            select(class="form-control" name="coverType_id" id="coverType_id")
              option(value="") -- Danh mục bìa --
              each coverType in coverTypes
                option(value=coverType.id)= coverType.title

          // --- Danh mục sách ---
          div(class="form-group")
            label(for="book_category_id") Danh mục sách
            select(class="form-control" name="book_category_id" id="book_category_id")
              option(value="") -- Danh mục sách --
              +select-tree-create(bookCategories)

          // --- Ảnh đại diện ---
          div(class="form-group" upload-image)
            label(for="thumbnail") Ảnh đại diện
            div(class="d-flex align-items-center gap-2")
              input(
                type="file"
                class="form-control-file"
                id="thumbnail"
                name="thumbnail"
                accept="image/*"
                upload-image-input
              )
              span(
                btn-close
                style="cursor:pointer; font-weight:bold;"
              )
            img(
              src=""
              class="image-preview mt-2"
              upload-image-preview
            )

          // --- Ảnh chi tiết ---
          div(class="form-group" upload-images)
            label(for="images") Ảnh chi tiết
            div(class="d-flex align-items-center gap-2")
              input(
                type="file"
                class="form-control-file"
                id="images"
                name="images"
                accept="image/*"
                upload-images-input
                multiple
              )
              span(style="cursor:pointer; font-weight:bold;")
            div(class="mt-2" preview-box)

          // --- Vị trí hiển thị ---
          div(class="form-group")
            label(for="position") Vị trí hiển thị
            input(
              id="position"
              class="form-control"
              type="number"
              name="position"
              min="1"
              placeholder="Tự động tăng"
            )

          // --- Trạng thái ---
          div(class="form-group")
            label(for="status") Trạng thái
            select(id="status" class="form-control" name="status")
              option(value="active") Hoạt động
              option(value="inactive") Ngừng hoạt động

          button(class="btn btn-primary mt-3" type="submit") Tạo mới
