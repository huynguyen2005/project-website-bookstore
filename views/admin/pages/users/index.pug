extends ../../layouts/default
include ../../mixins/pagination.pug
include ../../mixins/search.pug
include ../../mixins/formatDateTime.pug
include ../../mixins/alert.pug

block main
  +alert-success(5000)
  +alert-error(5000)

  if (role.permissions.includes("users_view"))
    div(class="card")
      div(class="card-header d-flex justify-content-between align-items-center")
        h5(class="mb-0") Danh sách người dùng

      div(class="card-body")
        div(class="d-flex align-items-center mb-3 flex-wrap gap-2")
          +search(keyword, "users")
          form(class="form-inline ml-3" form-filter action=`${prefixAdmin}/users` method="GET")
            select(class="form-control mr-2" name="status" id="status")
              option(value="") -- Trạng thái --
              option(value="active") Hoạt động
              option(value="inactive") Ngừng hoạt động
            button(class="btn btn-outline-secondary" type="submit") Lọc
            button.btn.btn-outline-secondary.ml-2(type="button" btn-clear-filter) Clear

        table(class="table table-hover table-bordered align-middle" check-box-multi)
          thead(class="thead-light")
            tr
              th(scope="col")
                input(type="checkbox" check-box-all)
              th(scope="col") Họ tên
              th(scope="col") Ảnh
              th(scope="col") Email
              th(scope="col") Đơn hàng
              th(scope="col") Trạng thái
          tbody
            if (users.length)
              each user in users
                tr
                  td
                    input(type="checkbox" name="id" value=user.id)
                  td
                    strong #{user.fullName}
                    br
                    small(class="text-muted")
                      a(href="javascript:;" data-id=user.id button-detail) Chi tiết
                      if (role.permissions.includes("users_delete"))
                        |  · 
                        a(href="javascript:;" data-id=user.id button-delete) Xóa
                  td
                    if (user.thumbnail)
                      img(src=user.thumbnail alt="avatar" style="width:40px; height:40px; border-radius:50%; object-fit:cover;")
                    else
                      i(class="bi bi-person-circle fs-4 text-secondary")
                  td #{user.email}
                  td #{user.totalOrdered}
                  td
                    if (user.status === "active")
                      span(class="badge-status badge-active") Hoạt động
                    else
                      span(class="badge-status badge-inactive") Ngừng hoạt động
            else
              tr
                td(colspan="6" class="text-center text-muted py-4") Không có dữ liệu người dùng

        +pagination(pagination)

        form(action="" method="POST" form-delete data-path=`${prefixAdmin}/users/delete` data-page=pagination.currentPage)
        form(action="" method="GET" form-detail data-path=`${prefixAdmin}/users/detail`)
