extends ../../layouts/default
include ../../mixins/formatDateTime.pug

block styles
  link(rel="stylesheet" href="/admin/css/detail.css")

block main
  if(role.permissions.includes("books_view"))
    .card.card-custom.shadow-sm
      .card-header.card-header-custom.d-flex.justify-content-between.align-items-center
        h5(class="mb-0") Chi tiết sách
        a(class="btn btn-back btn-sm" href=`${prefixAdmin}/books`)
          i(class="bi bi-arrow-left mr-1")
          span Quay lại

      .card-body
        // --- Tên sách
        h2.font-weight-bold.mb-3.text-dark #{book.bookName}

        // --- Mô tả
        if book.description
          p.text-secondary !{book.description}
        else
          p.text-secondary Không có mô tả

        hr.my-4

        // --- Thông tin cơ bản
        h6.section-title.mt-3.mb-3 Thông tin cơ bản
        .row
          .col-md-6
            p
              span.info-label Giá:
              |  
              span.text-danger.font-weight-bold #{book.price.toLocaleString()} VNĐ
            p
              span.info-label Giảm giá:
              |  #{book.discountPercent}%
            p
              span.info-label Số trang:
              |  #{book.pageCount}
            p
              span.info-label Kích thước:
              |  #{book.size}
            p
              span.info-label Ngày xuất bản:
              |  #{book.publishDate ? book.publishDate.toISOString().slice(0,10) : '—'}

          .col-md-6
            p
              span.info-label Tồn kho:
              |  #{book.stockQuantity}
            p
              span.info-label Đánh giá trung bình:
              |  #{book.averageRating}
            p
              span.info-label Lượt đánh giá:
              |  #{book.reviewCount}
            p
              span.info-label Nhà xuất bản:
              |  #{book.publisher}
            p
              span.info-label Nhà phân phối:
              |  #{book.distributor}

        hr.my-4

        // --- Phân loại & tình trạng
        h6.section-title.mt-3.mb-3 Phân loại & tình trạng
        .row
          .col-md-6
            p
              span.info-label Danh mục sách:
              |  #{categoryName}
            p
              span.info-label Loại bìa:
              |  #{coverTypeName}
            p
              span.info-label Tác giả:
              |  #{authorName}

          .col-md-6
            p
              span.info-label Trạng thái:
              if book.status === 'active'
                span.badge.badge-success.ml-1 Hoạt động
              else
                span.badge.badge-danger.ml-1 Ngừng hoạt động
            p
              span.info-label Vị trí hiển thị:
              |  #{book.position}
            p
              span.info-label Người tạo:
              |  #{book.accountFullName}
              span.info-label.ml-2 | Ngày tạo: 
              +formatDateTime(book.createdBy.createdAt)
            if(book.updatedBy.length)
              - const updatedBy = book.updatedBy.slice(-1)[0];
              p
                span.info-label Cập nhật gần nhất:
                |  #{updatedBy.fullName}
                span.info-label.ml-2 | Ngày cập nhật: 
                +formatDateTime(updatedBy.updatedAt)

        hr.my-4

        // --- Ảnh đại diện
        h6.section-title.mt-3.mb-3 Ảnh đại diện
        if book.thumbnail
          .d-flex.flex-column.align-items-start.mb-4
            img(src=book.thumbnail alt="Ảnh đại diện" class="img-thumbnail mb-2 shadow-sm rounded thumbnail-img")
            a(href=book.thumbnail target="_blank" class="small text-muted")= book.thumbnail
        else
          p.text-muted Không có ảnh đại diện

        // --- Ảnh chi tiết
        h6.section-title.mt-3.mb-3 Ảnh chi tiết
        if book.images && book.images.length
          .row.row-cols-2.row-cols-md-4.g-3
            each imgItem in book.images
              .col
                img(src=imgItem alt="Ảnh chi tiết" class="img-thumbnail shadow-sm rounded mb-2" style="max-width:160px;")
                a(href=imgItem target="_blank" class="small text-muted d-block")= imgItem
        else
          p.text-muted Không có ảnh chi tiết
