extends ../../layouts/default
include ../../mixins/select-tree.pug
include ../../mixins/alert.pug

block main
    +alert-success(5000)
    +alert-error(5000)
    .card
        .card-header.d-flex.justify-content-between.align-items-center
            h5.mb-0 Chỉnh sửa sách 
        .card-body
            form(
                action=`${prefixAdmin}/books/edit/${book.id}?_method=PATCH`
                method="POST"
                enctype="multipart/form-data"
            )
                div(class="form-group")
                    label(for="bookName") Tên sách
                    input(id="bookName" class="form-control" type="text" name="bookName" placeholder="Nhập tên sách" value=book.bookName)

                div(class="form-group")
                    label(for="description") Mô tả
                    textarea(id="description" class="form-control" name="description" rows="3" placeholder="Nhập mô tả...") #{book.description}

                div(class="form-row")
                    div(class="form-group col-md-6")
                        label(for="price") Giá (VNĐ)
                        input(id="price" class="form-control" type="number" name="price" min="0" placeholder="VD: 170000" value=book.price)
                    div(class="form-group col-md-6")
                        label(for="discountPercent") Giảm giá (%)
                        input(id="discountPercent" class="form-control" type="number" name="discountPercent" min="0" max="100" placeholder="VD: 10" value=book.discountPercent)

                div(class="form-row")
                    div(class="form-group col-md-6")
                        label(for="size") Kích thước
                        input(id="size" class="form-control" type="text" name="size" placeholder="VD: 14x20cm" value=book.size)
                    div(class="form-group col-md-6")
                        label(for="publishDate") Ngày xuất bản
                        input(id="publishDate" class="form-control" type="date" name="publishDate" value=book.publishDate ? book.publishDate.toISOString().slice(0, 10) : '')

                div(class="form-row")
                    div(class="form-group col-md-6")
                        label(for="pageCount") Số trang
                        input(id="pageCount" class="form-control" type="number" name="pageCount" min="0" value=book.pageCount)
                    div(class="form-group col-md-6")
                        label(for="stockQuantity") Số lượng tồn kho
                        input(id="stockQuantity" class="form-control" type="number" name="stockQuantity" min="0" value=book. stockQuantity)

                div(class="form-row")
                    div(class="form-group col-md-6")
                        label(for="averageRating") Đánh giá trung bình
                        input(id="averageRating" class="form-control" type="number" step="0.1" name="averageRating" placeholder="VD: 4.0" value=book.averageRating)
                    div(class="form-group col-md-6")
                        label(for="reviewCount") Lượt đánh giá
                        input(id="reviewCount" class="form-control" type="number" name="reviewCount" placeholder="VD: 5000" value=book.reviewCount)

                div(class="form-row")
                    div(class="form-group col-md-6")
                        label(for="publisher") Nhà xuất bản
                        input(id="publisher" class="form-control" type="text" name="publisher" placeholder="VD: NXB Trẻ" value=book.publisher)
                    div(class="form-group col-md-6")
                        label(for="distributor") Nhà phân phối
                        input(id="distributor" class="form-control" type="text" name="distributor" placeholder="VD: Alpha Books" value=book.distributor)

                div(class="form-row")
                    div(class="form-group col-md-6")
                        label(for="authorName") Tác giả
                        input(id="authorName" class="form-control" type="text" name="authorName" placeholder="VD: Stephen Hawking" value=`${book.authors.join(', ')}`)
                    div(class="form-group col-md-6")
                        label(for="coverType_id") Loại bìa
                        select(id="coverType_id" class="form-control" name="coverType_id")
                            option(value="") -- Chọn loại bìa --
                            each coverType in coverTypes 
                                option(
                                    value = coverType.id
                                    selected=(coverType.id===book.coverType_id)
                                ) #{coverType.title}

                div(class="form-row")
                    div(class="form-group col-md-6")
                        label(for="book_category_id") Danh mục sách
                        select(id="book_category_id" class="form-control" name="book_category_id")
                            option(value="") -- Danh mục sách --
                                +select-tree-edit(bookCategories, 1, book.book_category_id)

                div(class="form-group" upload-image)
                    label(for="thumbnail") Ảnh đại diện
                    div(class="d-flex align-items-center gap-2")
                        input(
                            type="file"
                            class="form-control-file"
                            id="thumbnail"
                            name="thumbnail"
                            accept="image/*"
                            upload-image-input
                        )
                        span(
                            btn-close
                            style="cursor:pointer; font-weight:bold;"
                        ) 
                    img(
                        src=book.thumbnail
                        class="image-preview"
                        upload-image-preview
                    )

                div(class="form-group" upload-images)
                    label(for="images") Ảnh chi tiết
                    div(class="d-flex align-items-center gap-2")
                        input(
                            type="file"
                            class="form-control-file"
                            id="images"
                            name="images"
                            accept="image/*"
                            upload-images-input
                            multiple
                        )
                        span(
                            style="cursor:pointer; font-weight:bold;"
                        ) 
                    div(class="mt-2" preview-box)
                        each image in book.images
                            img(
                                src=image
                                class="image-preview"
                            )

                div(class="form-row")
                    div(class="form-group col-md-6")
                        label(for="position") Vị trí hiển thị
                        input(id="position" class="form-control" type="number" name="position" min="1" placeholder="Tự động tăng" value=book.position)
                    div(class="form-group col-md-6")
                        label(for="status") Trạng thái
                        select(id="status" class="form-control" name="status")
                            option(
                                value="active"
                                selected = book.status === "active"
                            ) Hoạt động
                            option(
                                value="inactive"
                                selected = book.status === "inactive"
                            ) Ngừng hoạt động

                button(class="btn btn-primary" type="submit") Chỉnh sửa
