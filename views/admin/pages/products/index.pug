extends ../../layouts/default
include ../../mixins/pagination.pug
include ../../mixins/search.pug

block main
  .card
    .card-header.d-flex.justify-content-between.align-items-center
      h5.mb-0 Danh sách sản phẩm

      .d-flex.align-items-center
        a(href=`${prefixAdmin}/products/create` class="btn btn-primary mr-2") + Thêm sản phẩm
          
        form.d-flex.align-items-center(
          action=`${prefixAdmin}/products/change-multi?_method=PATCH&page=${pagination.currentPage}`
          method="POST"
          form-change-multi
        )
          select.form-control.w-auto.mr-2(name="type")
            option(value="") -- Thao tác --
            option(value="active") Hoạt động
            option(value="inactive") Ngừng hoạt động
            option(value="delete-all") Xóa đã chọn
            option(value="export") Xuất Excel
          input(
            type="text"
            name="ids"
            value=""
            class="form-control d-none"
          )
          button(type="submit" class="btn btn-outline-secondary") Áp dụng


    .card-body
      .d-flex.align-items-center.mb-3
        +search(keyword)

        form.form-inline.ml-3(id="form-filter-products" action=`${prefixAdmin}/products` method="GET")
          select.form-control.mr-2(id="status")
            option(value="", selected = valueFilterStatus==="") -- Trạng thái --
            option(value="active", selected = valueFilterStatus==="active") Hoạt động
            option(value="inactive", selected = valueFilterStatus==="inactive") Ngừng hoạt động

          select.form-control.mr-2(category-level-1)
            option(value="", selected = valueFilterCategoryLevel1==="") -- Danh mục sách --
            each item in categoryLevel1List
              option(value=item, selected = valueFilterCategoryLevel1===item) #{item}

          select.form-control.mr-2(category-level-2)
            option(value="", selected = valueFilterCategoryLevel2==="") -- Loại sách --
            each item in categoryLevel2List
              option(value=item.genre data-parent=item.categoryName, selected = valueFilterCategoryLevel2===item.genreName) #{item.genreName}
          div.d-flex.gap-2
            button.btn.btn-outline-secondary.mr-2(button-filter-product) Lọc
            a.btn.btn-outline-secondary(href=`${prefixAdmin}/products`) Quay lại






      // Bảng sản phẩm
      table.table.table-hover.table-bordered.align-middle(check-box-multi)
        thead.thead-light
          tr
            th(scope="col")
              input(type="checkbox" check-box-all)
            th(scope="col") Hình ảnh
            th(scope="col") Tên sản phẩm
            th(scope="col") Giá / Giá đặc biệt
            th(scope="col") Số lượng
            th(scope="col") Vị trí
            th(scope="col") Trạng thái

        tbody
          each item in products
            tr
              td
                input(type="checkbox" name="id" value=item.id)
              td
                img(
                  src=item.thumbnail
                  alt=item.bookName
                )
              td
                strong #{item.bookName}
                br
                small.text-muted
                  a(
                    href="javascript:;"
                    data-id=item.id 
                    button-detail-product
                  ) Chi tiết
                  |  ·
                  a(
                    href="javascript:;"
                    data-id=item.id 
                    button-edit-product
                  )  Sửa 
                  |  · 
                  a(
                    href="javascript:;"
                    data-id = item.id
                    button-delete-product
                  ) Xóa  
                  if item.status === "inactive"
                    |  ·
                    span(
                      class = "text-success cursor-pointer"
                      data-id=item.id
                      data-status=item.status
                      button-change-status
                    )  Hoạt động 
                  else
                    |  · 
                    span(
                      class = "text-danger cursor-pointer"
                      data-id=item.id
                      data-status=item.status
                      button-change-status
                    ) Ngừng hoạt động
              td
                span.d-block #{item.price} VND
                small.text-muted #{(item.newPrice)} VND
              td #{item.stockQuantity}
              td #{item.position}
              td 
                if item.status === "active"
                  span(class="badge-status badge-active") Hoạt động
                else  
                  span(class="badge-status badge-inactive") Ngừng hoạt động

      +pagination(pagination)

      form(
        action=""
        method="POST"
        id="form-change-status"
        data-path=`${prefixAdmin}/products/change-status`
        data-page=pagination.currentPage
      )

      form(
        action=""
        method="POST"
        id="form-delete-product"
        data-path=`${prefixAdmin}/products/delete`
        data-page=pagination.currentPage
      )

      form(
        action=""
        method="GET"
        id="form-edit-product"
        data-path=`${prefixAdmin}/products/edit`
      )

      form(
        action=""
        method="GET"
        id="form-detail-product"
        data-path=`${prefixAdmin}/products/detail`
      )