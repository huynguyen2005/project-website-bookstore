extends ../../layouts/default
include ../../mixins/select-tree.pug

block styles
  link(rel="stylesheet", href="/admin/css/edit.css")
  
block main
  if (role.permissions.includes("books_edit"))
    .card
      .card-header.d-flex.justify-content-between.align-items-center
        h5.mb-0 Chỉnh sửa sách

      .card-body
        form(
          action=`${prefixAdmin}/books/edit/${book.id}?_method=PATCH`
          method="POST"
          enctype="multipart/form-data"
        )

          // --- Tên sách ---
          .form-group
            label(for="bookName") Tên sách
            input#bookName.form-control(
              type="text"
              name="bookName"
              placeholder="Nhập tên sách"
              value=book.bookName
            )
          // --- Nổi bật ---
          .form-group
            label(for="featured") Nổi bật
            .d-flex.align-items-center.gap-4
              .form-check.form-check-inline
                input#featured1.form-check-input(
                  type="radio"
                  name="featured"
                  value="1"
                  checked=(book.featured == 1)
                )
                form-check-label(for="featured1") Nổi bật
              .form-check.form-check-inline
                input#featured0.form-check-input(
                  type="radio"
                  name="featured"
                  value="0"
                  checked=(book.featured == 0)
                )
                form-check-label(for="featured0") Không

          // --- Mô tả ---
          .form-group
            label(for="description") Mô tả
            textarea#description.form-control(
              name="description"
              rows="3"
              placeholder="Nhập mô tả..."
            )= book.description

          // --- Giá và Giảm giá ---
          .form-row
            .form-group.col-md-6
              label(for="price") Giá (VNĐ)
              input#price.form-control(
                type="number"
                name="price"
                min="0"
                placeholder="VD: 170000"
                value=book.price
              )
            .form-group.col-md-6
              label(for="discountPercent") Giảm giá (%)
              input#discountPercent.form-control(
                type="number"
                name="discountPercent"
                min="0"
                max="100"
                placeholder="VD: 10"
                value=book.discountPercent
              )

          // --- Kích thước & Ngày xuất bản ---
          .form-row
            .form-group.col-md-6
              label(for="size") Kích thước
              input#size.form-control(
                type="text"
                name="size"
                placeholder="VD: 14x20cm"
                value=book.size
              )
            .form-group.col-md-6
              label(for="publishDate") Ngày xuất bản
              input#publishDate.form-control(
                type="date"
                name="publishDate"
                value=(book.publishDate ? book.publishDate.toISOString().slice(0, 10) : '')
              )

          // --- Số trang & Số lượng ---
          .form-row
            .form-group.col-md-6
              label(for="pageCount") Số trang
              input#pageCount.form-control(
                type="number"
                name="pageCount"
                min="0"
                value=book.pageCount
              )
            .form-group.col-md-6
              label(for="stockQuantity") Số lượng tồn kho
              input#stockQuantity.form-control(
                type="number"
                name="stockQuantity"
                min="0"
                value=book.stockQuantity
              )

          // --- Đánh giá trung bình & Lượt đánh giá ---
          .form-row
            .form-group.col-md-6
              label(for="averageRating") Đánh giá trung bình
              input#averageRating.form-control(
                type="number"
                step="0.1"
                name="averageRating"
                placeholder="VD: 4.0"
                value=book.averageRating
              )
            .form-group.col-md-6
              label(for="reviewCount") Lượt đánh giá
              input#reviewCount.form-control(
                type="number"
                name="reviewCount"
                placeholder="VD: 5000"
                value=book.reviewCount
              )

          // --- Nhà xuất bản & Nhà phân phối ---
          .form-row
            .form-group.col-md-6
              label(for="publisher") Nhà xuất bản
              input#publisher.form-control(
                type="text"
                name="publisher"
                placeholder="VD: NXB Trẻ"
                value=book.publisher
              )
            .form-group.col-md-6
              label(for="distributor") Nhà phân phối
              input#distributor.form-control(
                type="text"
                name="distributor"
                placeholder="VD: Alpha Books"
                value=book.distributor
              )

          // --- Tác giả & Loại bìa ---
          .form-row
            .form-group.col-md-6
              label(for="author_id") Tác giả
              select#author_id.form-control(name="author_id")
                option(value="") -- Chọn tác giả --
                each author in authors
                  option(
                    value=author._id
                    selected=(author.id === book.author_id)
                  ) #{author.fullName}

            .form-group.col-md-6
              label(for="coverType_id") Loại bìa
              select#coverType_id.form-control(name="coverType_id")
                option(value="") -- Chọn loại bìa --
                each coverType in coverTypes
                  option(
                    value=coverType._id
                    selected=(coverType.id === book.coverType_id)
                  ) #{coverType.title}

          // --- Danh mục sách ---
          .form-group
            label(for="book_category_id") Danh mục sách
            select#book_category_id.form-control(name="book_category_id")
              option(value="") -- Chọn danh mục sách --
              +select-tree-edit(bookCategories, 1, book.book_category_id)

          // --- Ảnh đại diện ---
          .form-group(upload-image)
            label(for="thumbnail") Ảnh đại diện
            .d-flex.align-items-center.gap-2
              label(for="thumbnail" class="btn btn-success d-flex align-items-center gap-2 m-0 px-3 py-2")
                i(class="bi bi-upload")
                span Chọn tệp
              input#thumbnail.d-none(
                type="file"
                name="thumbnail"
                accept="image/*"
                upload-image-input
                onchange="previewSingleImage(event)"
              )
            // Khu vực hiển thị ảnh đại diện
            .mt-2#preview-thumbnail.d-flex.flex-wrap.gap-2
              if book.thumbnail
                img.image-preview(src=book.thumbnail)

          // --- Ảnh chi tiết ---
          .form-group
            label(for="images") Ảnh chi tiết
            .d-flex.align-items-center.gap-2
              label(for="images" class="btn btn-success d-flex align-items-center gap-2 m-0 px-3 py-2")
                i(class="bi bi-upload")
                span Chọn tệp
              input#images.d-none(
                type="file"
                name="images"
                accept="image/*"
                upload-images-input
                multiple
                onchange="previewMultipleImages(event)" 
              )
            // Khu vực hiển thị ảnh
            .mt-2#preview-container.d-flex.flex-wrap.gap-2
              each image in book.images
                img.image-preview(src=image)

          // --- Vị trí & Trạng thái ---
          .form-row
            .form-group.col-md-6
              label(for="position") Vị trí hiển thị
              input#position.form-control(
                type="number"
                name="position"
                min="1"
                placeholder="Tự động tăng"
                value=book.position
              )
            .form-group.col-md-6
              label(for="status") Trạng thái
              select#status.form-control(name="status")
                option(value="active" selected=(book.status === "active")) Hoạt động
                option(value="inactive" selected=(book.status === "inactive")) Ngừng hoạt động

          button.btn.btn-primary.mt-3(type="submit") Cập nhật

  //- block scripts
  //- script(type="application/javascript" src="https://cdn.tiny.cloud/1/0bzmmjbf9dmxhanhkzanji4a4lqzirecteyi89dup2z4hgmj/tinymce/6/tinymce.min.js" referrerpolicy="origin")
