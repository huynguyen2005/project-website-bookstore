extends ../../layouts/default

block main
  if(role.permissions.includes("accounts_edit"))
    form(action=`${prefixAdmin}/accounts/edit/${account._id}?_method=PATCH` method="POST" enctype="multipart/form-data")
      div(class="card")
        div(class="card-header d-flex justify-content-between align-items-center")
          h5(class="mb-0") Chỉnh sửa tài khoản

        div(class="card-body")

          // --- Tab nội dung ---
          div(class="tab-content")
            div(class="tab-pane fade show active" id="account-info" role="tabpanel")
              h6(class="mb-3 fw-bold") Thông tin tài khoản

            // --- Email ---
            .form-row
              .form-group.col-md-6
                label(for="email") Email
                input(
                  id="email"
                  class="form-control"
                  type="email"
                  name="email"
                  required
                  value=account.email
                )

              // --- Mật khẩu ---
              .form-group.col-md-6
                label(for="password") Mật khẩu mới
                input(id="password" class="form-control" type="password" name="password" placeholder="Nhập mật khẩu mới")

            // --- Nhóm quyền ---
            .form-group
              label(for="role_id") Nhóm quyền
              select(id="role_id" class="form-control" name="role_id")
                option(value="") Lựa chọn
                each record in records
                  if record._id == account.role_id
                    option(value=record._id selected) #{record.title}
                  else
                    option(value=record._id) #{record.title}

            // --- Trạng thái ---
            .form-group
              label(for="status") Trạng thái
              .d-flex.align-items-center.gap-4
                .form-check.form-check-inline
                  input#active.form-check-input(
                    type="radio",
                    name="status",
                    value="active",
                    checked=(account.status === "active")
                  )
                  label.form-check-label(for="active") Hoạt động
                .form-check.form-check-inline
                  input#inactive.form-check-input(
                    type="radio",
                    name="status",
                    value="inactive",
                    checked=(account.status === "inactive")
                  )
                  label.form-check-label(for="inactive") Dừng hoạt động

          hr(class="my-4")

          // --- Thông tin cá nhân ---
          h6(class="mb-3 fw-bold") Thông tin cá nhân

          .form-row
            .form-group.col-md-6
              label(for="fullName") Họ và tên *
              input(
                id="fullName"
                class="form-control"
                type="text"
                name="fullName"
                required
                value=account.fullName
              )

            .form-group.col-md-6
              label(for="phone") Số điện thoại *
              input(
                id="phone"
                class="form-control"
                type="text"
                name="phone"
                required
                value=account.phone
              )

          .form-row
            .form-group.col-md-6
              label(for="address") Địa chỉ
              input(
                id="address"
                class="form-control"
                type="text"
                name="address"
                value=account.address
              )

            .form-group.col-md-6
              label(for="birthday") Ngày sinh
              input(
                id="birthday"
                class="form-control"
                type="date"
                name="birthday"
                value=account.birthday
              )

          // --- Ảnh đại diện ---
          .div.form-group.mb-4(upload-image)
            label(for="thumbnail") Ảnh đại diện

            // Nút chọn file kiểu custom
            .d-flex.align-items-center.gap-2
              label.btn.btn-success.d-flex.align-items-center.gap-2.m-0.px-3.py-2(for="thumbnail")
                i.bi.bi-upload
                span Chọn tệp

              // Input file ẩn
              input#thumbnail.d-none(
                type="file"
                name="thumbnail"
                accept="image/*"
                upload-image-input
                value=account.thumbnail
              )

            // Preview ảnh
            if account.thumbnail
              img.image-preview.mt-2(
                src=account.thumbnail
                upload-image-preview
                style="width:120px; height:120px; border-radius:10px; border:1px solid #ddd; object-fit:cover;"
              )
            else
              img.image-preview.mt-2(
                src=""
                upload-image-preview
                style="width:120px; height:120px; border-radius:10px; border:1px solid #ddd; object-fit:cover;"
              )

            // Nút xóa ảnh
            span(btn-close style="cursor:pointer; font-weight:bold;")

          div(class="text-end mt-4")
            button(class="btn btn-primary" type="submit") Lưu thay đổi
